<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hello Website - Time Tracking</title>
    <link rel="stylesheet" href="time_tracking_styles.css">
    <script src="script.js"></script>
</head>
<body style="background-color: #8de6ea; justify-content: center ">
    <h1>Time Tracking</h1>
    
    <div class="container">
        <h2>Select an Activity</h2>
        <div class="activity-options" id="activity-options">
            <div class="activity-button" data-activity="badminton">Badminton</div>
            <div class="activity-button" data-activity="computer games">Computer Games</div>
            <div class="activity-button" data-activity="eating">Eating</div>
        </div>
        
        <div class="add-activity-container" id="add-activity-container">
            <input type="text" id="new-activity-input" placeholder="Enter new activity name">
            <button id="confirm-add-activity">Add</button>
        </div>
        
        <div class="time-history" id="time-history">
            <h3>Time History</h3>
            <div id="history-content">No activities tracked yet.</div>
        </div>
        
        <div class="controls">
            <button id="add-activity-btn">Add New Activity</button>
            <button id="download-json-btn">Download as JSON</button>
        </div>
    </div>
    
    <div class="navigation">
        <a href="index.html">Home</a>
        <a href="Unused/snake.html">Snake Game</a>
    </div>

    <script>
        // Time tracking variables
        let activities = ['badminton', 'computer games', 'eating'];
        let currentActivity = null;
        let activityStartTime = null;
        let timeHistory = {};
        
        // Load saved data from localStorage
        function loadSavedData() {
            const savedActivity = localStorage.getItem('currentActivity');
            const savedStartTime = localStorage.getItem('activityStartTime');
            const savedTimeHistory = localStorage.getItem('timeHistory');
            
            if (savedTimeHistory) {
                timeHistory = JSON.parse(savedTimeHistory);
                updateTimeHistoryDisplay();
            }
            
            if (savedActivity && savedStartTime) {
                currentActivity = savedActivity;
                activityStartTime = parseInt(savedStartTime);
                
                // Select the button
                const activityButtons = document.querySelectorAll('.activity-button');
                activityButtons.forEach(button => {
                    if (button.dataset.activity === currentActivity) {
                        button.classList.add('selected');
                    }
                });
            }
        }
        
        // Update the time history display
        function updateTimeHistoryDisplay() {
            const historyContent = document.getElementById('history-content');
            
            if (Object.keys(timeHistory).length === 0) {
                historyContent.textContent = 'No activities tracked yet.';
                return;
            }
            
            let historyHTML = '';
            for (const activity in timeHistory) {
                const minutes = Math.round(timeHistory[activity] / 60); // Convert ms to minutes
                historyHTML += `<div><strong>${activity}:</strong> ${minutes} minutes</div>`;
            }
            
            historyContent.innerHTML = historyHTML;
        }
        
        // Switch to a new activity
        function switchActivity(newActivity) {
            // If there's a current activity, record the time spent
            if (currentActivity && activityStartTime) {
                const timeSpent = Date.now() - activityStartTime;
                
                if (!timeHistory[currentActivity]) {
                    timeHistory[currentActivity] = 0;
                }
                
                timeHistory[currentActivity] += timeSpent;
                
                // Save to localStorage
                localStorage.setItem('timeHistory', JSON.stringify(timeHistory));
                updateTimeHistoryDisplay();
            }
            
            // Update current activity
            currentActivity = newActivity;
            activityStartTime = Date.now();
            
            // Save to localStorage
            localStorage.setItem('currentActivity', currentActivity);
            localStorage.setItem('activityStartTime', activityStartTime.toString());
            
            // Update UI
            const activityButtons = document.querySelectorAll('.activity-button');
            activityButtons.forEach(button => {
                if (button.dataset.activity === currentActivity) {
                    button.classList.add('selected');
                } else {
                    button.classList.remove('selected');
                }
            });
        }
        
        // Add a new activity
        function addNewActivity(activityName) {
            if (!activityName || activities.includes(activityName.toLowerCase())) {
                return;
            }
            
            const normalizedName = activityName.toLowerCase();
            activities.push(normalizedName);
            
            // Create new button
            const activityOptions = document.getElementById('activity-options');
            const newButton = document.createElement('div');
            newButton.className = 'activity-button';
            newButton.dataset.activity = normalizedName;
            newButton.textContent = activityName;
            
            // Add event listener
            newButton.addEventListener('click', function() {
                switchActivity(normalizedName);
            });
            
            activityOptions.appendChild(newButton);
            
            // Hide add activity form
            document.getElementById('add-activity-container').classList.remove('visible');
            document.getElementById('new-activity-input').value = '';
        }
        
        // Download time history as JSON
        function downloadTimeHistory() {
            // If there's a current activity, update the time spent
            if (currentActivity && activityStartTime) {
                const timeSpent = Date.now() - activityStartTime;
                
                // Create a copy of the time history to avoid modifying the original
                const historyForDownload = JSON.parse(JSON.stringify(timeHistory));
                
                if (!historyForDownload[currentActivity]) {
                    historyForDownload[currentActivity] = 0;
                }
                
                historyForDownload[currentActivity] += timeSpent;
                
                // Convert milliseconds to minutes for each activity
                for (const activity in historyForDownload) {
                    historyForDownload[activity] = Math.round(historyForDownload[activity] / 60);
                }
                
                // Create and download the JSON file
                const dataStr = JSON.stringify(historyForDownload, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
                
                const exportFileName = 'time_history_' + new Date().toISOString().slice(0, 10) + '.json';
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileName);
                linkElement.click();
            } else {
                // If no activity is selected, just download the current time history
                const historyForDownload = {};
                
                for (const activity in timeHistory) {
                    historyForDownload[activity] = Math.round(timeHistory[activity] / 1000);
                }
                
                const dataStr = JSON.stringify(historyForDownload, null, 2);
                const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
                
                const exportFileName = 'time_history_' + new Date().toISOString().slice(0, 10) + '.json';
                
                const linkElement = document.createElement('a');
                linkElement.setAttribute('href', dataUri);
                linkElement.setAttribute('download', exportFileName);
                linkElement.click();
            }
        }
        
        // Initialize when the DOM is fully loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Load saved data
            loadSavedData();
            
            // Add event listeners to activity buttons
            const activityButtons = document.querySelectorAll('.activity-button');
            activityButtons.forEach(button => {
                button.addEventListener('click', function() {
                    switchActivity(this.dataset.activity);
                });
            });
            
            // Add event listener to "Add New Activity" button
            document.getElementById('add-activity-btn').addEventListener('click', function() {
                document.getElementById('add-activity-container').classList.toggle('visible');
            });
            
            // Add event listener to confirm adding new activity
            document.getElementById('confirm-add-activity').addEventListener('click', function() {
                const activityName = document.getElementById('new-activity-input').value.trim();
                addNewActivity(activityName);
            });
            
            // Add event listener to input field for Enter key
            document.getElementById('new-activity-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    const activityName = this.value.trim();
                    addNewActivity(activityName);
                }
            });
            
            // Add event listener to download JSON button
            document.getElementById('download-json-btn').addEventListener('click', downloadTimeHistory);
            
            // Add event listener for page unload to record final time
            window.addEventListener('beforeunload', function() {
                if (currentActivity && activityStartTime) {
                    const timeSpent = Date.now() - activityStartTime;
                    
                    if (!timeHistory[currentActivity]) {
                        timeHistory[currentActivity] = 0;
                    }
                    
                    timeHistory[currentActivity] += timeSpent;
                    
                    // Update start time to now
                    activityStartTime = Date.now();
                    
                    // Save to localStorage
                    localStorage.setItem('timeHistory', JSON.stringify(timeHistory));
                    localStorage.setItem('activityStartTime', activityStartTime.toString());
                }
            });
        });
    </script>
</body>
</html>